#+TITLE: dired-image-thumbnail
#+AUTHOR: James Dyer
#+OPTIONS: toc:2 num:nil

* Introduction

=dired-image-thumbnail= is an Emacs package that extends =image-dired= with an enhanced workflow inspired by =dired-video-thumbnail=. It adds powerful sorting, filtering, subdirectory management, and flexible display options to the standard =image-dired= thumbnail viewer.

* Features

- *Sorting* - Sort thumbnails by name, date, size, or image dimensions
- *Filtering* - Filter by name regexp, file size range, or dimension range
- *Subdirectory support* - Works seamlessly with Dired's inserted subdirectories
- *Subdirectory helpers* - Commands to quickly insert/remove subdirectories
- *Wrap display mode* - Thumbnails flow naturally and wrap to window width
- *Enhanced header line* - Shows current image info, dimensions, sort/filter status
- *Window layout management* - Automatic split-screen layout (thumbnails left, image right)
- *Auto-display navigation* - Navigate with n/p to automatically show full-size images
- *Enhanced deletion* - Delete and advance with C-d in both thumbnail and image buffers
- *Full integration* - Works seamlessly with existing =image-dired= functionality
- *Transient menus* - Optional transient.el integration for discoverability

* Requirements

- Emacs 28.1 or later
- =image-dired= (built-in)
- =transient= (optional, for transient menu support)

* Installation

** Manual

Download =dired-image-thumbnail.el= and place it in your load-path:

#+begin_src emacs-lisp
(add-to-list 'load-path "/path/to/dired-image-thumbnail/")
(require 'dired-image-thumbnail)
#+end_src

** use-package

#+begin_src emacs-lisp
(use-package dired-image-thumbnail
  :load-path "/path/to/dired-image-thumbnail/"
  :demand t)
#+end_src

** straight.el

#+begin_src emacs-lisp
(straight-use-package
 '(dired-image-thumbnail :type git :host github :repo "captainflasmr/dired-image-thumbnail"))
#+end_src

* Usage

** Quick Start

The simplest way to use =dired-image-thumbnail= is from a Dired buffer:

1. Navigate to a directory containing images
2. Press =C-t d= (or =C-t m=) to view thumbnails
3. Thumbnails appear on the left, full-size image on the right
4. Navigate with =n=/=p= to automatically view each image
5. Use the enhanced keybindings for sorting, filtering, etc.

** Working with Subdirectories

=dired-image-thumbnail= works with Dired's subdirectory insertion feature. You have several options:

*** Manual insertion
Use Dired's built-in =i= (=dired-maybe-insert-subdir=) on any subdirectory to make its contents visible, then run =dired-image-thumbnail=.

*** Helper commands
- =C-t s= (=dired-image-thumbnail-insert-image-subdirs=) - Insert only subdirectories containing images (recommended)
- =C-t z= (=dired-image-thumbnail-insert-subdir-recursive=) - Insert all subdirectories
- =C-t k= (=dired-image-thumbnail-kill-all-subdirs=) - Remove all inserted subdirectories

** From Standard image-dired

You can also use the standard =image-dired= commands (=C-t d=, =C-t a=, etc.) - =dired-image-thumbnail= automatically enhances the thumbnail buffer with new keybindings.

* Enhanced Workflow

=dired-image-thumbnail= provides an enhanced grid-view workflow that improves upon standard =image-dired=:

** Automatic Split-Screen Layout

When you launch =dired-image-thumbnail= (or use standard =image-dired= with this package loaded):

#+begin_example
┌──────────────────┬────────────────────────┐
│  Thumbnails      │  Full-size Image       │
│  (Left 50%)      │  (Right 50%)           │
│                  │                        │
│  [img1] ←──      │  ┌──────────────────┐  │
│  [img2]          │  │                  │  │
│  [img3]          │  │   Current Image  │  │
│  [img4]          │  │                  │  │
│  [img5]          │  └──────────────────┘  │
│                  │                        │
└──────────────────┴────────────────────────┘
#+end_example

The layout is automatically configured via =display-buffer-alist= when =dired-image-thumbnail-manage-window-layout= is enabled (default).

** Auto-Display Navigation

With =dired-image-thumbnail-auto-display-on-navigate= enabled (default):

- Press =n= or =p= to navigate thumbnails
- The full-size image automatically updates on the right
- No need to press =RET= or =C-<return>= for each image
- Smooth, fluid browsing experience

** Quick Deletion Workflow

Press =C-d= in either the thumbnail or image display buffer to:

1. Get a confirmation prompt
2. Delete the current image file
3. Automatically advance to the next image
4. Continue browsing seamlessly

This makes culling large photo collections much faster than the standard workflow.

* Keybindings

** In Dired Buffer

| Key     | Command                                      | Description                          |
|---------+----------------------------------------------+--------------------------------------|
| =C-t d= | ~image-dired~ + ~dired-image-thumbnail-refresh~ | Launch standard image-dired enhanced |
| =C-t m= | ~dired-image-thumbnail~                        | Launch enhanced thumbnail viewer     |
| =C-t s= | ~dired-image-thumbnail-insert-image-subdirs~   | Insert subdirs with images           |
| =C-t z= | ~dired-image-thumbnail-insert-subdir-recursive~ | Insert all subdirs recursively       |
| =C-t k= | ~dired-image-thumbnail-kill-all-subdirs~       | Remove all inserted subdirs          |

** In Thumbnail Buffer

*** Navigation

| Key     | Command                                   | Description                              |
|---------+-------------------------------------------+------------------------------------------|
| =n=, =→= | ~dired-image-thumbnail-next-image~          | Next image (auto-display when enabled)   |
| =p=, =←= | ~dired-image-thumbnail-previous-image~      | Previous image (auto-display when enabled) |
| =+=     | ~dired-image-thumbnail-increase-size~       | Increase thumbnail size                  |
| =-=     | ~dired-image-thumbnail-decrease-size~       | Decrease thumbnail size                  |

Note: When =dired-image-thumbnail-auto-display-on-navigate= is enabled (default), pressing =n= or =p= automatically displays the full-size image in the right window.

*** Marking

| Key   | Command                                    | Description                     |
|-------+--------------------------------------------+---------------------------------|
| =s n= | ~dired-image-thumbnail-sort-by-name~         | Sort by filename                |
| =s d= | ~dired-image-thumbnail-sort-by-date~         | Sort by modification date       |
| =s s= | ~dired-image-thumbnail-sort-by-size~         | Sort by file size               |
| =s D= | ~dired-image-thumbnail-sort-by-dimensions~   | Sort by image dimensions (area) |
| =s r= | ~dired-image-thumbnail-sort-reverse~         | Reverse sort order              |
| =S=   | ~dired-image-thumbnail-sort~ (transient)     | Interactive sort selection      |

*** Filtering

| Key   | Command                                    | Description                |
|-------+--------------------------------------------+----------------------------|
| =/ n= | ~dired-image-thumbnail-filter-by-name~       | Filter by name regexp      |
| =/ s= | ~dired-image-thumbnail-filter-by-size~       | Filter by file size range  |
| =/ d= | ~dired-image-thumbnail-filter-by-dimensions~ | Filter by dimension range  |
| =/ /= | ~dired-image-thumbnail-filter-clear~         | Clear all filters          |
| =/ c= | ~dired-image-thumbnail-filter-clear~         | Clear all filters          |
| =\=   | ~dired-image-thumbnail-filter~ (transient)   | Interactive filter menu    |

*** Display

| Key | Command                              | Description              |
|-----+--------------------------------------+--------------------------|
| =w= | ~dired-image-thumbnail-toggle-wrap~    | Toggle wrap display mode |
| =r= | ~dired-image-thumbnail-refresh~        | Refresh the display      |
| =+= | ~dired-image-thumbnail-increase-size~  | Increase thumbnail size  |
| =-= | ~dired-image-thumbnail-decrease-size~  | Decrease thumbnail size  |

*** Marking

| Key | Command                                 | Description        |
|-----+-----------------------------------------+--------------------|
| =M= | ~dired-image-thumbnail-mark-all~          | Mark all images    |
| =t= | ~dired-image-thumbnail-toggle-all-marks~  | Toggle all marks   |

*** File Operations

| Key   | Command                                   | Description                    |
|-------+-------------------------------------------+--------------------------------|
| =D=   | ~dired-image-thumbnail-delete~              | Delete image at point          |
| =C-d= | ~dired-image-thumbnail-delete-and-next~     | Delete image and move to next  |
| =x=   | ~dired-image-thumbnail-delete-marked~       | Delete all marked images       |
| =d=   | ~dired-image-thumbnail-goto-dired~          | Jump to file in Dired          |

*** Other

| Key   | Command                        | Description |
|-------+--------------------------------+-------------|
| =?/h= | ~dired-image-thumbnail-help~     | Show help   |

*In Image Display Buffer:*

| Key   | Command                                       | Description                    |
|-------+-----------------------------------------------+--------------------------------|
| =C-d= | ~dired-image-thumbnail-delete-image-and-next~   | Delete image and move to next  |

Note: All standard =image-dired= keybindings (=n=, =p=, =m=, =u=, =U=, etc.) continue to work as expected.

* Header Line

The enhanced header line displays:

- *Mark indicator* - A =*= if the current image is marked
- *Filename* - Relative to source directory when subdirectories are inserted
- *Image count* - Current position / total (e.g., =23/156=)
- *Dimensions* - Width × Height in pixels (e.g., =1920x1080=)
- *File size* - Human-readable size (e.g., =2.4M=)
- *Sort indicator* - Current sort field and direction (e.g., =[name ↑]=)
- *Active filters* - Description of any active filters
- *Marked count* - Number of marked images (e.g., =[3 marked]=)

* Customization

All customization options are in the =dired-image-thumbnail= group. Use =M-x customize-group RET dired-image-thumbnail RET= to browse them interactively.

** Default Sort Settings

#+begin_src emacs-lisp
(setq dired-image-thumbnail-sort-by 'name)      ; 'name, 'date, 'size, or 'dimensions
(setq dired-image-thumbnail-sort-order 'ascending) ; 'ascending or 'descending
#+end_src

** Display Options

#+begin_src emacs-lisp
(setq dired-image-thumbnail-wrap-display nil)   ; Enable wrap display by default
#+end_src

** Window Layout

Control the automatic split-screen layout:

#+begin_src emacs-lisp
(setq dired-image-thumbnail-manage-window-layout t)  ; Enable split-screen layout
#+end_src

When enabled (default), thumbnails appear on the left (50% width) and the full-size image display appears on the right (50% width).

** Navigation Behavior

Control whether navigating with =n=/=p= automatically displays full-size images:

#+begin_src emacs-lisp
(setq dired-image-thumbnail-auto-display-on-navigate t)  ; Auto-display on n/p
#+end_src

When enabled (default), pressing =n= or =p= in the thumbnail buffer automatically updates the image display buffer. When disabled, you must press =RET= or =C-<return>= to view full-size images.

** Image Extensions

Add or modify recognized image file extensions:

#+begin_src emacs-lisp
(setq dired-image-thumbnail-image-extensions
      '("jpg" "jpeg" "png" "gif" "bmp" "tiff" "tif" "webp" "svg" "ico" "heic" "heif"))
#+end_src

* Example Configuration

#+begin_src emacs-lisp
(use-package dired-image-thumbnail
  :load-path "/path/to/dired-image-thumbnail/"
  :demand t
  :custom
  (dired-image-thumbnail-sort-by 'date)
  (dired-image-thumbnail-sort-order 'descending)
  (dired-image-thumbnail-wrap-display t)
  (dired-image-thumbnail-manage-window-layout t)      ; Split-screen layout
  (dired-image-thumbnail-auto-display-on-navigate t)  ; Auto-display on n/p
  :bind
  (:map dired-mode-map
   ("C-t d" . (lambda () (interactive)
                (image-dired default-directory)
                (dired-image-thumbnail-refresh)))
   ("C-t m" . dired-image-thumbnail)
   ("C-t s" . dired-image-thumbnail-insert-image-subdirs)
   ("C-t z" . dired-image-thumbnail-insert-subdir-recursive)
   ("C-t k" . dired-image-thumbnail-kill-all-subdirs)))
#+end_src

* Workflow Examples

** Reviewing a Photo Collection

1. Open directory in Dired: =C-x d ~/Photos RET=
2. Insert subdirectories with images: =C-t s=
3. View thumbnails: =C-t m=
4. Thumbnails appear on the left, full-size view on the right
5. Sort by date (newest first): =s d= then =s r=
6. Browse with =n= / =p= - images automatically update on the right
7. Mark keepers with =m=, jump to Dired with =d=

** Finding Large Images

1. View thumbnails: =C-t m=
2. Grid appears on left, image display on right
3. Filter by size: =/ s= and enter =1M= for minimum, leave maximum empty
4. Sort by size (largest first): =s s= then =s r=
5. Navigate with =n=/=p= to review each image
6. Mark images for deletion with =m=, delete with =x=
7. Or use =C-d= to delete current image and advance to next

** Quick Culling Workflow

1. View thumbnails: =C-t m=
2. Navigate through images with =n= and =p=
3. Press =C-d= on images you want to delete
4. Confirmation prompt appears for each deletion
5. Automatically advances to next image after deletion
6. Continue until finished

** Finding High-Resolution Images

1. View thumbnails: =C-t m=
2. Filter by dimensions: =/ d= and enter minimum width =1920=, minimum height =1080=
3. Browse only HD+ images
4. Use =/ c= to clear the filter when done

** Working with Subdirectories

1. Open parent directory in Dired
2. Use =C-t s= to insert only subdirectories containing images (fast)
3. Or use =C-t z= to insert all subdirectories (may be slow with many dirs)
4. View thumbnails with =C-t m=
5. Images from all visible subdirectories will be shown
6. Use =C-t k= to remove all subdirectories and return to top-level view

** Organizing by Date

1. Open directory in Dired
2. Insert subdirectories if needed: =C-t s=
3. View thumbnails: =C-t m=
4. Sort by date: =s d=
5. Use the header line to see file dates as you browse

* Comparison with Standard image-dired

| Feature                | image-dired | dired-image-thumbnail |
|------------------------+-------------+-----------------------|
| Thumbnail display      | ✓           | ✓                     |
| Dired integration      | ✓           | ✓                     |
| Sorting                | ✗           | ✓ (4 criteria)        |
| Filtering              | ✗           | ✓ (name, size, dims)  |
| Subdirectory support   | ✗           | ✓ (via insertion)     |
| Helper commands        | ✗           | ✓                     |
| Wrap display           | ✗           | ✓                     |
| Enhanced header line   | Basic       | Enhanced              |
| Auto-display on n/p    | ✗           | ✓                     |
| Split-screen layout    | ✗           | ✓ (automatic)         |
| Delete and advance     | ✗           | ✓ (C-d)               |
| Transient menus        | ✗           | ✓ (optional)          |

* Transient Menu Support

If =transient= is available, =dired-image-thumbnail= provides interactive menus for sorting and filtering. These can be accessed with:

- =S= - Sort menu (shows all sort options and current state)
- =\= - Filter menu (shows all filter options and current filters)

To disable transient menus even when transient is installed, don't load =dired-image-thumbnail-transient.el=.

* Performance Notes

** Subdirectory Insertion

When working with large directory trees:

- Use =dired-image-thumbnail-insert-image-subdirs= (=C-t s=) instead of =dired-image-thumbnail-insert-subdir-recursive= (=C-t z=)
- The "smart" insertion only processes subdirectories containing images, which is much faster
- For very large collections, manually insert specific subdirectories with =i= as needed

** Thumbnail Generation

First-time thumbnail generation can be slow for large images. Thumbnails are cached by =image-dired=, so subsequent viewing is fast.

* Troubleshooting

** Images not appearing

- Ensure =image-dired= is working: test with =C-t d= in a directory with images
- Check that file extensions are in =dired-image-thumbnail-image-extensions=
- Verify thumbnails are being created in =image-dired-dir=

** Subdirectories not showing images

- Ensure subdirectories are actually inserted in the Dired buffer (use =i= or helper commands)
- Check that =dired-image-thumbnail-insert-image-subdirs= found subdirectories (watch for message)
- Verify files in subdirectories have recognized image extensions

** Slow performance with many directories

- Use =C-t s= (insert image subdirs only) instead of =C-t z= (insert all subdirs)
- Manually insert specific subdirectories with =i= as needed
- Consider filtering to reduce the number of visible thumbnails

** Layout not splitting correctly

- Ensure =dired-image-thumbnail-manage-window-layout= is =t= (default)
- Check that no other packages are overriding =display-buffer-alist=
- Try =M-x display-buffer-alist= to inspect the current rules
- Manually delete other windows with =C-x 1= before launching

** Auto-display not working

- Ensure =dired-image-thumbnail-auto-display-on-navigate= is =t= (default)
- The feature requires the split-screen layout to be active
- Try pressing =RET= on a thumbnail to manually trigger display

* Related Packages

- [[https://www.gnu.org/software/emacs/manual/html_node/emacs/Image_002dDired.html][image-dired]] - Built-in image thumbnail browser for Dired (extended by this package)
- [[https://github.com/captainflasmr/dired-video-thumbnail][dired-video-thumbnail]] - Video thumbnail browser (inspiration for this package)
- [[https://github.com/alexluigit/dirvish][dirvish]] - A modern file manager for Emacs with preview support

* License

GPL-3.0-or-later
